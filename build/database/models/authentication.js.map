{"version":3,"file":"authentication.js","names":["userSchema","mongoose","Schema","name","type","String","required","email","unique","password","pre","next","user","isModified","bcrypt","hash","User","model","signup","save","login","findOne","Error","compare","isMatch","payload","id","_id","token","helper","generate"],"sources":["../../../src/database/models/authentication.js"],"sourcesContent":["import mongoose from \"mongoose\";\r\nimport bcrypt from \"bcrypt\";\r\nimport 'dotenv/config';\r\nimport * as helper from '../../helpers';\r\n\r\nconst userSchema = new mongoose.Schema({\r\n  name: {\r\n    type: String,\r\n    required: true,\r\n  },\r\n  email: {\r\n    type: String,\r\n    required: true,\r\n    unique: true,\r\n  },\r\n  password: {\r\n    type: String,\r\n    required: true,\r\n  },\r\n});\r\n\r\nuserSchema.pre(\"save\", async function (next) {\r\n  const user = this;\r\n  if (user.isModified(\"password\")) {\r\n    user.password = await bcrypt.hash(user.password, 8);\r\n  }\r\n  next();\r\n});\r\n\r\nexport const User = mongoose.model(\"User\", userSchema);\r\n\r\nexport const signup = async (name, email, password) => {\r\n  const user = new User({ name, email, password });\r\n  await user.save();\r\n  return user;\r\n};\r\n\r\nexport const login = async (email, password) => {\r\n  const user = await User.findOne({ email });\r\n  if (!user) throw new Error(\"Invalid email or password\");\r\n\r\n  const isMatch = await bcrypt.compare(password, user.password);\r\n  if (!isMatch) throw new Error(\"Invalid email or password\");\r\n  const payload = {\r\n    id: user._id\r\n  }\r\n  const token = helper.token.generate(payload);\r\n  return {user, token};\r\n};\r\n"],"mappings":";;;;;;;AAAA;AACA;AACA;AACA;AAAwC;AAAA;AAAA;AAAA,+CAFxC;AAAA;AAAA;AAIA,IAAMA,UAAU,GAAG,IAAIC,oBAAQ,CAACC,MAAM,CAAC;EACrCC,IAAI,EAAE;IACJC,IAAI,EAAEC,MAAM;IACZC,QAAQ,EAAE;EACZ,CAAC;EACDC,KAAK,EAAE;IACLH,IAAI,EAAEC,MAAM;IACZC,QAAQ,EAAE,IAAI;IACdE,MAAM,EAAE;EACV,CAAC;EACDC,QAAQ,EAAE;IACRL,IAAI,EAAEC,MAAM;IACZC,QAAQ,EAAE;EACZ;AACF,CAAC,CAAC;AAEFN,UAAU,CAACU,GAAG,CAAC,MAAM;EAAA,sEAAE,iBAAgBC,IAAI;IAAA;IAAA;MAAA;QAAA;UACnCC,IAAI,GAAG,IAAI;UAAA,KACbA,IAAI,CAACC,UAAU,CAAC,UAAU,CAAC;YAAA;YAAA;UAAA;UAAA;UAAA,OACPC,kBAAM,CAACC,IAAI,CAACH,IAAI,CAACH,QAAQ,EAAE,CAAC,CAAC;QAAA;UAAnDG,IAAI,CAACH,QAAQ;QAAA;UAEfE,IAAI,EAAE;QAAC;QAAA;UAAA;MAAA;IAAA;EAAA,CACR;EAAA;IAAA;EAAA;AAAA,IAAC;AAEK,IAAMK,IAAI,GAAGf,oBAAQ,CAACgB,KAAK,CAAC,MAAM,EAAEjB,UAAU,CAAC;AAAC;AAEhD,IAAMkB,MAAM;EAAA,uEAAG,kBAAOf,IAAI,EAAEI,KAAK,EAAEE,QAAQ;IAAA;IAAA;MAAA;QAAA;UAC1CG,IAAI,GAAG,IAAII,IAAI,CAAC;YAAEb,IAAI,EAAJA,IAAI;YAAEI,KAAK,EAALA,KAAK;YAAEE,QAAQ,EAARA;UAAS,CAAC,CAAC;UAAA;UAAA,OAC1CG,IAAI,CAACO,IAAI,EAAE;QAAA;UAAA,kCACVP,IAAI;QAAA;QAAA;UAAA;MAAA;IAAA;EAAA,CACZ;EAAA,gBAJYM,MAAM;IAAA;EAAA;AAAA,GAIlB;AAAC;AAEK,IAAME,KAAK;EAAA,uEAAG,kBAAOb,KAAK,EAAEE,QAAQ;IAAA;IAAA;MAAA;QAAA;UAAA;UAAA,OACtBO,IAAI,CAACK,OAAO,CAAC;YAAEd,KAAK,EAALA;UAAM,CAAC,CAAC;QAAA;UAApCK,IAAI;UAAA,IACLA,IAAI;YAAA;YAAA;UAAA;UAAA,MAAQ,IAAIU,KAAK,CAAC,2BAA2B,CAAC;QAAA;UAAA;UAAA,OAEjCR,kBAAM,CAACS,OAAO,CAACd,QAAQ,EAAEG,IAAI,CAACH,QAAQ,CAAC;QAAA;UAAvDe,OAAO;UAAA,IACRA,OAAO;YAAA;YAAA;UAAA;UAAA,MAAQ,IAAIF,KAAK,CAAC,2BAA2B,CAAC;QAAA;UACpDG,OAAO,GAAG;YACdC,EAAE,EAAEd,IAAI,CAACe;UACX,CAAC;UACKC,KAAK,GAAGC,MAAM,CAACD,KAAK,CAACE,QAAQ,CAACL,OAAO,CAAC;UAAA,kCACrC;YAACb,IAAI,EAAJA,IAAI;YAAEgB,KAAK,EAALA;UAAK,CAAC;QAAA;QAAA;UAAA;MAAA;IAAA;EAAA,CACrB;EAAA,gBAXYR,KAAK;IAAA;EAAA;AAAA,GAWjB;AAAC"}